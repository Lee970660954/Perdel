<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    实现一个类，可以on, emit, off, once, 注册、调用、取消、注册仅能使用一次的事件
    <p>实现一个类，具备on，emit，off，once方法，分别完成事件注册、事件触发、事件取消和事件触发后无法再触发</p>
    <script>
        class Event {
            constructor () {
                this.events = new Map();
                this.onceEvents = new Map();
            }
            on (eType, eHandler) {
                if (this.events.get(eType)) {
                    let curHandlerList = this.events.get(eType);
                    curHandlerList.push(eHandler);
                    this.events.set(eType, curHandlerList);
                } else {
                    this.events.set(eType, [eHandler]);
                }
            }
            emit (eType) {
                if (this.events.get(eType)) {
                    let args = [...arguments].slice(1);
                    let curHandlerList = this.events.get(eType);
                    curHandlerList.forEach(item => {
                        item.apply(this, args);
                    });
                }
                if (this.onceEvents.get(eType)) {
                    let args = [...arguments].slice(1);
                    let curHandlerList = this.onceEvents.get(eType);
                    curHandlerList.forEach(item => {
                        item.apply(this, args);
                    });
                    this.onceEvents.delete(eType);
                }
            }
            off (eType) {
                if (this.events.get(eType)) {
                    this.events.delete(eType);
                }
            }
            once (eType, eHandler) {
                if (this.onceEvents.get(eType)) {
                    let curOnceEvents = this.onceEvents.get(eType);
                    curOnceEvents.push(eHandler);
                    this.onceEvents.set(eType, curOnceEvents);
                } else {
                    this.onceEvents.set(eType, [eHandler]);
                }
            }
        }
        const event = new Event();
        event.on("test1", function () {
            console.log("test11")
        })
        event.on("test1", function () {
            console.log("test12")
        })
        event.emit("test1");
        event.off("test1");
        event.emit("test1");
        event.once("test2", function () {
            console.log("test21")
        })
        event.once("test2", function () {
            console.log("test22")
        })
        event.emit("test2");
        event.emit("test2");
    </script>
    <p>
        思路：
        1.定义Event类，on、emit、off和once等为Event类的原型上的方法。
        2.on注册：
        （1）在Event类的构造函数中定义events属性，数据类型为Map，用于存储注册的事件，key为事件名，value为注册的事件回调函数的数组。
        3.emit触发：
        （1）当使用Event实例的emit方法触发事件时，遍历events属性中对应的回调函数数组，并依次执行。
        （2）遍历onceEvents属性中对应的回调函数数组，并依次执行，执行完毕后，删除onceEvents中对应的事件注册字段。
        4.off注销：
        （1）当使用Event实例的off方法注销事件时，在events属性中删除对应的事件注册字段。
        5.once注册仅执行一次的事件
        （1）在Event类的构造函数中定义onceEvents属性，数据类型为Map，用于存储注册仅执行一次的事件，key为事件名，value为注册的事件回调函数的数组。
    </p>
</body>
</html>